+ OWNER=yoshiko-pg
+ REPO=difit
+ OUTPUT_DIR=./reports
++ date +%Y%m%d_%H%M%S
+ OUTPUT_FILE=./reports/pr_contributors_yoshiko-pg_difit_20250731_191710.csv
+ [[ yoshiko-pg == \-\h ]]
+ [[ yoshiko-pg == \-\-\h\e\l\p ]]
+ main yoshiko-pg difit
+ echo 'ğŸš€ GitHub Pull Request Contributor Analyzer'
+ echo ===========================================
+ check_requirements
+ missing_commands=()
+ local missing_commands
+ command -v gh
+ command -v jq
+ [[ 0 -gt 0 ]]
+ check_github_auth
+ gh auth status
+ check_repository_access
+ echo 'ğŸ” Checking repository access...'
+ gh repo view yoshiko-pg/difit
+ echo 'âœ… Repository access confirmed'
+ setup_output_directory
+ [[ ! -d ./reports ]]
+ analyze_contributors
+ echo ''
+ echo 'ğŸ“Š Starting pull request contributor analysis...'
+ echo 'Repository: yoshiko-pg/difit'
+ echo 'Output file: ./reports/pr_contributors_yoshiko-pg_difit_20250731_191710.csv'
+ echo ----------------------------------------
+ gh api graphql --field owner=yoshiko-pg --field repo=difit --field 'query=
        query($owner: String!, $repo: String!) {
          repository(owner: $owner, name: $repo) {
            pullRequests(first: 100, orderBy: {field: CREATED_AT, direction: DESC}) {
              totalCount
              nodes {
                author {
                  login
                  ... on User {
                    id
                    databaseId
                  }
                }
              }
            }
          }
        }
      '
+ jq '
      # ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç·æ•°ã‚’å–å¾—ï¼ˆå‚è€ƒæƒ…å ±ã¨ã—ã¦ï¼‰
      .data.repository.pullRequests.totalCount as $total |
      
      # ä½œæˆè€…æƒ…å ±ã‚’æŠ½å‡ºãƒ»æ•´ç†
      .data.repository.pullRequests.nodes 
      | map(select(.author != null and .author.login != null))
      | map({
          userId: (.author.databaseId // "unknown"),
          username: .author.login
        })
      
      # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«é›†è¨ˆ
      | group_by(.username)
      | map({
          userId: .[0].userId,
          username: .[0].username,
          pullRequestCount: length
        })
      
      # è²¢çŒ®åº¦é †ã«ã‚½ãƒ¼ãƒˆ
      | sort_by(-.pullRequestCount)
      
      # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
      | {
          metadata: {
            totalPullRequests: $total,
            analyzedDate: now | strftime("%Y-%m-%d %H:%M:%S"),
            contributorCount: length
          },
          contributors: .
        }
    '
+ tee ./reports/pr_contributors_yoshiko-pg_difit_20250731_191710.csv
+ gh api --template '
{{/* ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦å‡ºåŠ› */}}
# Pull Request Contributor Analysis Report
# Repository: yoshiko-pg/difit
# Generated: {{.metadata.analyzedDate}}
# Total Contributors: {{.metadata.contributorCount}}
# ----------------------------------------
userId,username,pullrequestå›æ•°
{{/* å„è²¢çŒ®è€…ã®æƒ…å ±ã‚’å‡ºåŠ› */}}
{{range .contributors}}
{{.userId}},"{{.username | replace "\"" "\"\""}}",{{.pullRequestCount}}
{{end}}
' --input -
accepts 1 arg(s), received 0
