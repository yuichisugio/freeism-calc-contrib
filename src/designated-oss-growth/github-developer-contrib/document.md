# developer contribution

## 概要

## 使い方

### リポジトリ全体で初回のみ

1. [GitHub CLI(`gh`)](https://cli.github.com/)のインストール
1. [`gh auth login`](https://cli.github.com/manual/gh_auth_login)でログイン
1. [jq](https://stedolan.github.io/jq/download/) をインストール
1. シェルで、以下を実行
   ```shell
   git clone https://github.com/yuichisugio/freeism-contribution-calculate.git
   ```
   ※一部で、初回のみ GitHub の Personal Access Token が必要な場合がある。その場合は、各評価軸の`document.md`に記載

### 処理を実行

1. 分析する場合
   ```shell
   ./main.sh [option] [path]
   ```

### 分析結果を削除したい場合

1. シェルで、以下を実行
   ```shell
   ./reset.sh [オプション]
   ```
   - オプションなしで、`results`フォルダのデータをすべて削除
   - `-p`or`-pull-request`で`pull-request`フォルダのみ削除
   - `-p`or`-issue`で`issue`フォルダのみ削除
   - `-m`or`-main`で`main`フォルダのみ削除

## 出力形式

### 出力される形式は以下

1.  CSV 形式
1.  JSON 形式
    - 後々対応

### 表示するカラムは以下

1.  データ取得元サービス名
1.  データ取得元ユーザー名
1.  データ取得元ユーザー ID
1.  タスク名
1.  データ取得元タスク ID
1.  タスクの貢献度
1.  貢献度の算出ロジック
1.  各重み付けの値
1.  メモ
1.  算出日

### JSON 形式

```json
{
	"meta": {
		"createdAt": "2025-08-20",
		"specified-oss": {
			"owner": "ryoppippi",
			"Repository": "ccusage"
		}
	},
	"data": [
		{
			"host": "gitlab.com",
			"owner": "group",
			"repo": "lib-b",
			"evaluation": {
				"result": 3
				"evaluationCriteria": {
					"timeResources": 3
				}
			}
		},
		{
			"host": "github.com",
			"owner": "acme",
			"repo": "lib-a",
			"package_manager_url": "pack-D",
			"homepage": "page-p",
			"repository_url": "git/e"
		}
	]
}
```

### CSV 形式

```csv
meta,createdAt,specified-oss
meta,specified-oss,
```

## 今後追加したい内容

1. 期間を指定して貢献度の算出ができる仕組み
   - API 制限的に一度に取得できる数に限りがあるため、以前の分析に追加で取得したい
   - インクリメンタルなデータ取得・貢献度の分析を行いたい
1. 以前の分析を使用して、足りない部分のみデータ取得する仕組み
   - API 制限的に一度に取得できる数に限りがあるため、以前の`./results`フォルダの結果を使用したい
1. Zenn など他 API からも情報を取得して貢献度を算出する

## 評価軸を追加・削除・変更したい場合

1. `./src`フォルダ直下に、
1. `./src/get-data`フォルダ直下に、新規ファイルを作成して、新しくデータを取得する処理を入れる
1. `./src/data-process`に、フォルダ直下に、新規ファイルを作成して、新しくデータの加工処理を入れる
1. `./src/calc-weighted`フォルダ直下に、重み付けの値を算出する処理を追加実装する
1. `./src/calc-contrib/calc-amount-contrib.sh`に、貢献度を算出する処理を入れる

## 貢献度の算出方法

### 概要

- 各指標の分析結果を使用して、貢献度を算出する
  1.  それぞれの評価軸の計算方法で、重み付けに使用する値を算出
  1.  全ての評価軸の重み付け値を掛け算して、タスクごとの貢献度を算出
  1.  タスクごとの貢献度を、ユーザーごとに合算する

### 評価軸の一覧

1. 貢献の実施期間
1. 作業量
1. 参加者からの評価
1. 対応速度
1. タスクの種類

### 各指標ごとの計算式

### 貢献の実施期間

- 初期にコミットするほど、プロジェクトを見つけて発展させる貢献度は大きので、重み付けする

1. 「ライブラリ作成日」と「最後の main ブランチへのコミット日」をプロジェクト全体の期間として設定して、その期間を 5 分割（最初期・初期・中期・後期・最終期）にして、タスク実施日が当てはまる期間で重み付け
   - 期間の終わりを今日にすると、5 年前などから更新がないプロジェクトで、すべてのタスクが古い認定になるので、最後はコミット日にする

### 作業量

- 作業量を 5 段階評価して重み付け

1. プルリクエスト・コミットのコード追加・削除の行数（Lines of Code, LoC）
   - `additions`（追加行数）、`deletions`（削除行数）から判断
   - `1-10`,`11-50`,`51-200`,`201-1000`,`1001-`の行数の条件で、一旦は設定する
   - プルリク系・コミット系のすべてで、↑ を使用する
   -
1. コメントの追加・削除の行数（無理なら文字数）
   - コメントがある Issue・プルリク・Discussions のすべてで、↑ を使用する
   - `1-10`,`11-50`,`51-200`,`201-1000`,`1001-`の行数の条件で、一旦は設定する
1. イシューやプルリクの行数
   - 無駄に冗長な場合は、バッドマークの絵文字を付けてマイナスに重み付けする
1. それ以外のタスクの種類の場合は、重み付けの値は`1`に設定する

### 参加者からの評価

- リアクションの数を 5 段階評価して、重み付け
  - `0`,`1-20`,`21-50`,`51-100`,`101-`個のリアクション数で、5 段階評価にする

1. コメントへのリアクションの数
   - pullRequest,Issue,Discussions などのリアクションの数で評価

### 対応速度

- 説明

  - 各タスクごとの対応速度で重み付け

- 種類
  1.  Issue 作成から対応するプルリクエスト作成日までの対応速度
  1.  プルリク作成からマージ or リジェクトまでの期間
  1.  c

### タスクの種類

1. GitHub API から取得できるタスク全部（プルリクエスト・Issue・ドキュメント整備・など）

#### プルリクエスト

1. プルリクエストの作成（Merged・Approved）
   - `approved`は承認済みだけどマージはまだ
1. プルリクエストの作成（Closed）
1. プルリクエストの作成（Open・Draft・Pending・Changes requested）
1. プルリクエストにコメント投稿
1. プルリクエストをマージ
1. プルリクエストをレビューして、Approved or Closed
1. プルリクエストにラベル付け

#### イシュー

1. イシュー作成（Closed - Completed）
1. イシュー作成（Closed - Not planned）
1. イシュー作成（Open）
1. イシューにコメント
1. イシューのステータスを変更（Open・Closed）
1. イシューにラベル付けをする
1. 担当者をアサイン（アサインする側）

#### ディスカッション

1. ディスカッションの作成
1. コメントを投稿
1. コメントにリアクション
1. ラベル付けをする
1. カテゴリー分けをする

#### スポンサー

1. スポンサー（大・単発）
1. スポンサー（中・単発）
1. スポンサー（小・単発）
1. スポンサー（大・毎月）
1. スポンサー（中・毎月）
1. スポンサー（小・毎月）

#### コミット

1. main ブランチへのコミット
   - 基本はプルリクエストで管理したい
   - GitHub API で、branchProtectionRules オブジェクトが Require a pull request before merging が`true`の場合は、不要
   - コミットは、main ブランチに直接プッシュした場合のみカウントしたい

$$
f(a, b) =
\begin{cases}
0.1x & (y \geq 1) \\
1    & (y \lt 1)\end{cases}
$$
