# `freeism-contribution-calculate`

## 概要

- 指定 OSS への各ユーザーごとの貢献度を分析してくれる

## 今後追加したい内容

- 追加コード行数（Lines of Code, LoC）の評価を追加したい。
- issue 関連のタスクを貢献度の算出に入れる

## 使用方法

### 初回のみ

1. GitHub CLI(`gh`)のインストールして、`gh auth login`でログイン
1. シェルで、以下を実行
   ```shell
   git clone https://github.com/yuichisugio/freeism-contribution-calculate.git
   ```
1. シェルで、以下を実行
   ```shell
   chmod +x ./main.sh && chmod +x ./reset.sh
   ```

### 分析したい場合

1. シェルで、以下を実行
   ```shell
   ./main.sh [リポジトリ所有者名] [リポジトリ名]
   ```
1. `results/main`フォルダに、分析結果が CSV 形式で入る

### 分析結果を削除したい場合

1. シェルで、以下を実行
   ```shell
   ./reset.sh [オプション]
   ```
   - オプションなしで、`results`フォルダのデータをすべて削除
   - `-p`or`-pull-request`で`pull-request`フォルダのみ削除
   - `-p`or`-issue`で`issue`フォルダのみ削除
   - `-m`or`-main`で`main`フォルダのみ削除

### 評価する指標を追加・削除したい場合

1.
1.

## 出力される分析内容

1. ユーザーごとの貢献度の一覧
   | databaseId | username | 貢献度 | 各指標<br>ごとの値 | 算出に使用<br>するの値 |
   | :--------: | :------: | :----: | :----------------: | :--------------------: |
   | A | B | C | D | E |
   | F | G | H | I | J |
   | K | L | M | N | O |
1. タスクごとの貢献度の一覧
   | databaseId | タスク名 | タスクの種類 | 貢献度 | 各指標<br>ごとの値
   | :--------: | :--------: | :------: | :----: | :----------------: |
   | A | B | C | D | E |
   | F | G | H | I | J |
   | K | L | M | N | O |

## 指標一覧

1. 貢献の実施期間
1. 作業量
1. タスクの種類
1. 対応速度
1. 参加者からの評価

## 貢献度の算出方法

- 各指標の分析結果を使用して、平均値や重み付けを行い、貢献度を算出する

1. それぞれの評価軸から、重み付けに使用するデータを算出
1. 重み付け値を掛け算して、タスクごとの貢献度を算出
1. タスクごとの貢献度を、ユーザーごとに合算する

## 各指標ごとの計算式

### 貢献の実施期間

- 初期にコミットするほど、プロジェクトを見つけて発展させる貢献度は大きので、重み付けする

1. 「ライブラリ作成日」と「最後の main ブランチへのコミット日」をプロジェクト全体の期間として設定して、その期間 5 分割して、最初期・初期・中期・後期・最終期して、タスク実施日が当てはまる期間で重み付け
   - 終わりを今日にすると、最後を今日にすると、5 年前から更新がないプロジェクトですべてが古くなるので、最後はコミット日にする

### 対応速度

- 各タスクごとの対応速度で重み付け

1. Issue 作成から対応するプルリクエスト作成日までの対応速度
1. プルリク作成からマージ or リジェクトまでの期間
1. c

### 作業量

- 作業量を 5 段階評価して重み付け

1. プルリクエストのコード変更数
   - `additions`（追加行数）、`deletions`（削除行数）から判断
   - プルリク系のすべてで、↑ を使用する
   - 追加・削除コード行数（Lines of Code, LoC）
1. コミットのコード変更数
1. コード以外の対応は、一旦重み付け`2`にする

### 参加者からの評価

- リアクションの数を 5 段階評価して、重み付け
   - 0,1-20,21-50,51-100,101-

1. コメントへのリアクションの数
   - pullRequest,Issue,Discussions などのリアクションの数で評価

### タスクの種類

1. GitHub API から取得できるタスク全部（プルリクエスト・Issue・ドキュメント整備・など）

#### プルリクエスト

1. プルリクエストの作成（Merged・Approved）
   - `approved`は承認済みだけどマージはまだ
1. プルリクエストの作成（Closed）
1. プルリクエストの作成（Open・Draft・Pending・Changes requested）
1. プルリクエストにコメント投稿
1. プルリクエストをマージ
1. プルリクエストをレビューして、Approved or Closed
1.

#### イシュー

1. イシュー作成（Closed - Completed）
1. イシュー作成（Closed - Not planned）
1. イシュー作成（Open）
1. イシューにコメント
1. イシューのステータスを変更

#### ディスカッション

1. ディスカッションの場を立ち上げる
1. コメントを投稿
1. コメントにリアクション
1. c
1. c
1. c

#### スポンサー

1. スポンサー（大）
1. スポンサー（中）
1. スポンサー（小）

#### コミット

1. main ブランチへのコミット
   - 基本はプルリクエストで管理したい
   - GitHub API で、branchProtectionRules オブジェクトが Require a pull request before merging が`true`の場合は、不要
   - コミットは、main ブランチに直接プッシュした場合のみカウントしたい

## シェルスクリプトで実装した理由

1. どの言語を学んでいる人でも理解しやすい
2. 自分が勉強したかった
3. 環境構築が楽

## 設計で気を付けたこと

1. 評価軸を追加・削除できるように疎結合にした
   - また、ファイルもタスクごとではなく、評価軸ごとに分けた
1. 可読性のために、シェルスクリプトはファイルを分ける。
   - 不要であれば、後からリファクタで一つのファイルにつなげる
1.

## 推奨

1. `.github/CODEOWNERS`を設定して、自動でレビューアーのアサインがされるように設定
   - アサインも評価に含めるため。
1.
